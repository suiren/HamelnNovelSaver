name: ğŸ—‘ï¸ Cleanup Old Workflow Runs

on:
  schedule:
    # æ¯æœˆ1æ—¥ã®åˆå‰2æ™‚ã«å®Ÿè¡Œ
    - cron: '0 2 1 * *'
  workflow_dispatch:
    inputs:
      days_to_keep:
        description: 'ä¿æŒã™ã‚‹æ—¥æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼š30æ—¥ï¼‰'
        required: false
        default: '30'
        type: string

jobs:
  cleanup:
    name: ğŸ§¹ å¤ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã®å‰Šé™¤
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ—‘ï¸ å¤ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚’å‰Šé™¤
      uses: Mattraks/delete-workflow-runs@v2
      with:
        token: ${{ github.token }}
        repository: ${{ github.repository }}
        retain_days: ${{ github.event.inputs.days_to_keep || '30' }}
        keep_minimum_runs: 5
        delete_workflow_pattern: 'CI/CD Pipeline for Hameln Novel Saver'
        delete_run_by_conclusion_pattern: 'failure,cancelled'
        
    - name: ğŸ“Š ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†å ±å‘Š
      run: |
        echo "ğŸ‰ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œå±¥æ­´ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ"
        echo "ğŸ“… ${{ github.event.inputs.days_to_keep || '30' }}æ—¥ã‚ˆã‚Šå¤ã„å®Ÿè¡Œã‚’å‰Šé™¤"
        echo "ğŸ”„ æœ€ä½5å€‹ã®å®Ÿè¡Œã¯ä¿æŒ"
        echo "âŒ å¤±æ•—ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå®Ÿè¡Œã‚’å„ªå…ˆå‰Šé™¤"