# 開発プロセス全般における過去のミス記録

## 🚨 **重要**: このファイルは将来のセッションでの同様ミス防止用

---

## 📅 **2025年7月15日のセッション - CI/CD開発**

### **❌ 発生したミス**

#### **1. actions/upload-artifact非推奨バージョン使用**
- **ミス**: `actions/upload-artifact@v3` を使用
- **結果**: 「This request has been automatically failed because it uses a deprecated version」
- **正解**: `actions/upload-artifact@v4` を使用すべき
- **原因**: 最新バージョン確認不足

#### **2. YAML構文エラー**
- **ミス**: 複数行Python文字列をYAMLに直接記述
- **結果**: 「You have an error in your yaml syntax on line 202」
- **正解**: 別ファイルにPythonスクリプトを分離して実行
- **原因**: YAML構文理解不足

#### **3. 依存関係インストール不一致**
- **ミス**: CI/CDで手動パッケージリスト、requirements.txtを無視
- **結果**: 「ModuleNotFoundError: No module named 'brotli'」
- **正解**: `pip install -r requirements.txt` で統一
- **原因**: 依存関係管理の不一致

#### **4. ローカル事前テスト不足**
- **ミス**: CI/CDにプッシュしてからエラー発見
- **結果**: 複数回の失敗実行履歴蓄積
- **正解**: ローカルで事前に全テスト実行
- **原因**: テスト駆動開発の徹底不足

---

## 🔧 **防止策実装済み**

1. **ローカル事前検証スクリプト**: `test_local_environment.py`
2. **requirements.txt統一**: 全ジョブで`pip install -r requirements.txt`
3. **YAML構文改善**: Python長文は別ファイル分離
4. **最新バージョン使用**: actions/upload-artifact@v4

---

## 📋 **今後のセッションでの必須チェック項目**

### **CI/CD関連タスク開始時**
- [ ] 最新のGitHub Actions公式ドキュメント確認
- [ ] requirements.txtと実際のインストール処理の一致確認
- [ ] YAMLファイルの構文チェック実行
- [ ] ローカル環境での事前テスト必須実行

### **プッシュ前必須実行**
```bash
python test_local_environment.py
```
このスクリプトが全て成功するまでプッシュ禁止

---

## 🎯 **教訓**

1. **「小さなミスが大きな問題に」**: バージョン違い1文字が全体停止
2. **「ローカルテスト最重要」**: CI/CDは最後の確認、事前検証必須
3. **「設定ファイル統一性」**: requirements.txtと実装の乖離は致命的
4. **「構文チェック基本」**: YAML等の構文は事前確認必須

---

## 📅 **2025年7月15日のセッション - ビルドテスト不備**

### **❌ 発生したミス**

#### **1. ローカルテストスクリプトの不完全性**
- **ミス**: `test_local_environment.py`にビルドテストを含めなかった
- **結果**: CI/CDで「Spec file "HamelnBookDownloader.spec" not found!」エラー
- **正解**: ローカルでpyinstallerビルドテストを必須にすべき
- **原因**: テスト範囲の見落とし、手抜き

#### **2. 自分で作ったミス防止システムの無視**
- **ミス**: CLAUDE.mdのチェックリストを形骸化させた
- **結果**: 基本的な確認作業の怠慢
- **正解**: チェックリストの厳格な遵守
- **原因**: 「簡単だから大丈夫」という慢心

#### **3. CI/CDワークフローの実行ディレクトリ未確認**
- **ミス**: GitHub Actionsでの作業ディレクトリ確認不足
- **結果**: 既存ファイルが見つからないエラー
- **正解**: 実行環境とローカル環境の差異を必ず確認
- **原因**: 環境差異の認識不足

### **🔧 防止策実装必要**
- ローカルテストスクリプトにpyinstallerビルドテスト追加
- CI/CDワークフローの実行パス確認
- CLAUDE.mdチェックリストの厳格化

### **📋 今後のチェック項目**
- [ ] ローカルテストにビルドプロセス全体を含める
- [ ] CI/CD環境とローカル環境の差異確認を必須化
- [ ] チェックリスト項目の形骸化防止

### **🧠 ミス発生メカニズム（根本原因）**

#### **1. 認知バイアス問題**
- **確証バイアス**: 「ローカルで部分テストが通った＝全体が問題ない」の思い込み
- **楽観バイアス**: 「前回うまくいったから今回も大丈夫」の根拠なき自信
- **手続き記憶の劣化**: チェックリストを「知っている」と「実行している」の混同

#### **2. システム思考の欠如**
- **部分最適の罠**: 個別要素のテストで全体動作を保証できると錯覚
- **依存関係の軽視**: CI/CD環境とローカル環境の差異を「たぶん問題ない」で済ませる
- **エラー伝播の想像力不足**: 小さな設定ミスが全体停止につながる想像力欠如

#### **3. プロセス管理の破綻**
- **ルール形骸化メカニズム**: 自分で作ったルールほど「今回は特別」で破りがち
- **段階的手抜きパターン**: 最初は完璧→慣れで省略→重要部分も省略の悪化スパイラル
- **検証の先送り癖**: 「後で確認すればいい」が「結局確認しない」になる心理

### **🔄 同じメカニズムで起こりうる他のミス**
- **デプロイ設定**: 「ローカルで動く＝本番で動く」錯覚
- **セキュリティ設定**: 「テスト環境で問題ない＝本番も安全」思い込み
- **データベース**: 「小規模データで動く＝大規模でも動く」楽観視
- **API統合**: 「一部機能で動く＝全機能で動く」部分最適思考

### **🎯 メカニズムレベルでの教訓**
1. **「部分成功≠全体成功」**: システム全体の検証なしに安心してはいけない
2. **「慣れ=危険信号」**: 慣れた作業ほど手抜きが始まる瞬間を自覚する
3. **「自分ルール=最も破りやすい」**: 自分で作ったルールこそ他者の監視が必要

---

## 📅 **2025年7月15日のセッション - .gitignoreによるファイル除外見落とし**

### **❌ 発生したミス**

#### **1. .gitignore設定の見落とし**
- **ミス**: `*.spec`が.gitignoreで除外されていることを見落とし
- **結果**: CI/CDで「HamelnBookDownloader.spec not found」エラー
- **正解**: git管理下ファイルの確認を事前に実施すべき
- **原因**: 部分的検証（ローカル存在確認のみ）での思い込み

#### **2. 環境同期確認の不備**
- **ミス**: 「ローカルにある=リモートにある」の錯覚
- **結果**: git管理外ファイルを見落とし
- **正解**: `git ls-files`でリモート同期状態を確認
- **原因**: 確証バイアス（部分成功→全体成功の錯覚）

#### **3. ローカルテストスクリプトの不完全性（再発）**
- **ミス**: ローカルテストで`git ls-files`確認を含めていない
- **結果**: 同種のミスを2回繰り返し
- **正解**: git管理状態確認をローカルテストに追加
- **原因**: 前回の教訓を活かせていない学習不足

### **🧠 同じ発生メカニズムの確認**
- **確証バイアス**: ローカル確認成功で全体を錯覚（再発）
- **部分最適の罠**: ファイル存在確認で git 管理確認を省略（再発）
- **検証先送り**: 「後で確認」→「結局確認しない」（再発）

### **🔧 防止策実装必要**
- ローカルテストに`git ls-files`でのファイル管理確認追加
- .gitignore設定の定期見直し
- CI/CDで使用するファイルのgit管理状態事前確認

### **📋 今後のチェック項目**
- [ ] git管理状態確認をローカルテスト必須化
- [ ] .gitignore設定と実際の必要ファイルの整合性確認
- [ ] 「ローカル存在≠リモート存在」の原則徹底

### **🎯 メカニズムレベルでの教訓**
1. **「同じ思考パターン=同じミス再発」**: 根本的思考パターンが変わっていない証拠
2. **「部分確認の危険性」**: ファイル存在確認だけでは不十分
3. **「学習の形骸化」**: 前回の教訓を実際に活かせていない

---

## 🤖 **ミス発生時の自動対応ルール**

### **Claude必須実行事項**
1. **即座にMISTAKES_LOG.mdにミス記録を追加**
   - 日付、タスク内容、ミス詳細、原因分析、防止策を記録
2. **CLAUDE.mdの該当セクションを強化**
   - 新しいチェック項目を追加
   - 禁止事項リストを更新
3. **関連する検証スクリプトを作成・改善**
   - ローカル事前検証の強化
   - 自動チェック機能の追加

### **テンプレート**
```markdown
## 📅 **[日付] - [タスク種別]**

### **❌ 発生したミス**
#### **[ミス名]**
- **ミス**: [具体的な間違い]
- **結果**: [発生した問題]
- **正解**: [正しい方法]
- **原因**: [根本原因]

### **🔧 防止策実装済み**
- [実装した対策1]
- [実装した対策2]

### **📋 今後のチェック項目**
- [ ] [新しいチェック項目1]
- [ ] [新しいチェック項目2]
```

---

## 📚 **参考リンク**
- [GitHub Actions公式ドキュメント](https://docs.github.com/en/actions)
- [actions/upload-artifact最新情報](https://github.com/actions/upload-artifact)
- [YAML構文チェッカー](https://yaml-online-parser.appspot.com/)